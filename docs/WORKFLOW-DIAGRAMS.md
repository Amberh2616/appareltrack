# Fashion Production System - æµç¨‹åœ–èˆ‡è§¸ç™¼é»

**å»ºç«‹æ—¥æœŸï¼š** 2026-01-18
**ç‰ˆæœ¬ï¼š** v4.28.0

æ­¤æ–‡æª”åŒ…å«ç³»çµ±å®Œæ•´çš„éšæ®µæµç¨‹åœ–å’Œè§¸ç™¼é»èªªæ˜ã€‚

---

## ç›®éŒ„

- [ä¸€ã€æ•´é«”æµç¨‹ç¸½è¦½](#ä¸€æ•´é«”æµç¨‹ç¸½è¦½)
- [äºŒã€Phase 1ï¼šé–‹ç™¼éšæ®µ](#äºŒphase-1é–‹ç™¼éšæ®µ)
- [ä¸‰ã€Phase 2ï¼šæ¨£è¡£éšæ®µ](#ä¸‰phase-2æ¨£è¡£éšæ®µ)
- [å››ã€Phase 3ï¼šå ±åƒ¹éšæ®µ](#å››phase-3å ±åƒ¹éšæ®µ)
- [äº”ã€Phase 4ï¼šå¤§è²¨éšæ®µ](#äº”phase-4å¤§è²¨éšæ®µ)
- [å…­ã€è§¸ç™¼é»ç¸½è¡¨](#å…­è§¸ç™¼é»ç¸½è¡¨-t1-t10)
- [ä¸ƒã€æ•¸æ“šæ¨¡å‹é—œè¯åœ–](#ä¸ƒæ•¸æ“šæ¨¡å‹é—œè¯åœ–)

---

## ä¸€ã€æ•´é«”æµç¨‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æˆè¡£å» å®Œæ•´å·¥ä½œæµç¨‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘   Phase 1     â•‘         â•‘   Phase 2     â•‘         â•‘   Phase 3     â•‘         â•‘   Phase 4     â•‘
   â•‘   é–‹ç™¼éšæ®µ    â•‘ â”€â”€â”€â”€â”€â”€â–¶ â•‘   æ¨£è¡£éšæ®µ    â•‘ â”€â”€â”€â”€â”€â”€â–¶ â•‘   å ±åƒ¹éšæ®µ    â•‘ â”€â”€â”€â”€â”€â”€â–¶ â•‘   å¤§è²¨éšæ®µ    â•‘
   â•‘               â•‘         â•‘               â•‘         â•‘               â•‘         â•‘               â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚                         â”‚                         â”‚                         â”‚
    Tech Pack               Run 1-5              CostSheet            ProductionOrder
    ä¸Šå‚³/è§£æ/æ‰¹å‡†          æ¨£è¡£é–‹ç™¼/å ±åƒ¹          å¤§è²¨å ±åƒ¹              MRP/æ¡è³¼
```

### éšæ®µèªªæ˜

| éšæ®µ | åç¨± | ä¸»è¦å…§å®¹ | è¼¸å‡º |
|------|------|----------|------|
| Phase 1 | é–‹ç™¼éšæ®µ | Tech Pack ä¸Šå‚³ã€AI è§£æã€ç¿»è­¯å¯©æ ¡ | Approved Revision |
| Phase 2 | æ¨£è¡£éšæ®µ | Run 1-5 æ¨£è¡£é–‹ç™¼ã€å ±åƒ¹ | Accepted Sample |
| Phase 3 | å ±åƒ¹éšæ®µ | å¤§è²¨å ±åƒ¹ã€å®¢æˆ¶ç¢ºèª | Accepted Bulk Quote |
| Phase 4 | å¤§è²¨éšæ®µ | ç”Ÿç”¢è¨‚å–®ã€MRPã€æ¡è³¼ | PurchaseOrder |

---

## äºŒã€Phase 1ï¼šé–‹ç™¼éšæ®µ

### æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Phase 1: é–‹ç™¼éšæ®µ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ä¸Šå‚³æ–‡ä»¶   â”‚ â”€â”€â”€â–¶ â”‚  AI åˆ†é¡    â”‚ â”€â”€â”€â–¶ â”‚  AI æå–    â”‚
    â”‚  /upload    â”‚      â”‚  /classify  â”‚      â”‚  /extract   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                        â”‚
           â”‚                                        â–¼
           â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                               â”‚ å‰µå»º Revision   â”‚
           â”‚                               â”‚ + DraftBlocks   â”‚
           â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                        â”‚
           â–¼                                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     äººå·¥å¯©æ ¡                            â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Tech Pack    â”‚  â”‚    BOM       â”‚  â”‚    Spec      â”‚  â”‚
    â”‚  â”‚ ç¿»è­¯å¯©æ ¡     â”‚  â”‚   ç·¨è¼¯ç¿»è­¯   â”‚  â”‚   ç·¨è¼¯ç¿»è­¯   â”‚  â”‚
    â”‚  â”‚ /review      â”‚  â”‚   /bom       â”‚  â”‚   /spec      â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Approve Revision  â”‚â—€â”€â”€â”€â”€â”€â”€ æ‰¹å‡†å¾Œå¯é€²å…¥ Phase 2
                    â”‚   æ‰¹å‡† Revision     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 1 è§¸ç™¼é»

| æ“ä½œ | API | é é¢ |
|------|-----|------|
| ä¸Šå‚³æ–‡ä»¶ | `POST /api/v2/uploaded-documents/` | `/dashboard/upload` |
| AI åˆ†é¡ | `POST /api/v2/uploaded-documents/{id}/classify/` | `/dashboard/documents/{id}/processing` |
| AI æå– | `POST /api/v2/uploaded-documents/{id}/extract/` | `/dashboard/documents/{id}/review` |
| æ‰¹å‡† Revision | `POST /api/v2/revisions/{id}/approve/` | `/dashboard/revisions/{id}/review` |

### è©³ç´°å­æµç¨‹ï¼šTech Pack ç¿»è­¯

```
éšæ®µ 1ï¼šä¸Šå‚³èˆ‡åˆ†é¡
  â””â†’ /dashboard/upload
  â””â†’ POST /api/v2/uploaded-documents/
  â””â†’ POST /api/v2/uploaded-documents/{id}/classify/

éšæ®µ 2ï¼šAI æå–
  â””â†’ /dashboard/documents/{id}/review
  â””â†’ POST /api/v2/uploaded-documents/{id}/extract/
  â””â†’ å‰µå»º TechPackRevision + DraftBlocks
  â””â†’ è¿”å› tech_pack_revision_id

éšæ®µ 3ï¼šäººå·¥å¯©æ ¡
  â””â†’ è‡ªå‹•å°èˆªï¼ˆ2ç§’å¾Œï¼‰åˆ° /dashboard/revisions/{id}/review
  â””â†’ PATCH /api/v2/draft-blocks/{id}/ ï¼ˆç·¨è¼¯ edited_textï¼‰
  â””â†’ POST /api/v2/revisions/{id}/approve/

éšæ®µ 4ï¼šBOM/Spec ç¿»è­¯
  â””â†’ /dashboard/revisions/{id}/bom - BOM ç¿»è­¯ç·¨è¼¯
  â””â†’ /dashboard/revisions/{id}/spec - Spec ç¿»è­¯ç·¨è¼¯
  â””â†’ å–®é …ç¿»è­¯ + æ‰¹é‡ AI ç¿»è­¯
```

---

## ä¸‰ã€Phase 2ï¼šæ¨£è¡£éšæ®µ

### æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Phase 2: æ¨£è¡£éšæ®µ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Revision approved
         â”‚
         â”‚ ã€T1ã€‘Create Sample Request
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SampleRequest   â”‚
   â”‚    (draft)      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ ã€T1+ã€‘Confirm Sample  â—€â”€â”€â”€â”€â”€â”€ åŸå­æ“ä½œï¼Œè‡ªå‹•ç”Ÿæˆä»¥ä¸‹å…§å®¹ï¼š
         â–¼                                â”œâ”€ SampleRun #1
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”œâ”€ RunBOMLine (BOM å¿«ç…§)
   â”‚   è‡ªå‹•ç”Ÿæˆ                       â”‚    â”œâ”€ RunOperation (å·¥åºå¿«ç…§)
   â”‚   â”œâ”€ SampleRun                  â”‚    â”œâ”€ SampleMWO
   â”‚   â”œâ”€ SampleMWO                  â”‚    â”œâ”€ SampleCostEstimate
   â”‚   â””â”€ CostSheetVersion (sample)  â”‚    â””â”€ UsageScenario + CostSheetVersion
   â”‚   â””â”€ UsageScenario              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘                          SampleRun ç‹€æ…‹æ©Ÿ (12 ç‹€æ…‹)                                â•‘
   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
   â•‘                                                                                    â•‘
   â•‘    draft â”€â”€â–¶ materials_planning â”€â”€â–¶ po_drafted â”€â”€â–¶ po_issued                      â•‘
   â•‘      â”‚              10%                  20%           30%                         â•‘
   â•‘      â”‚                                                   â”‚                         â•‘
   â•‘      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â•‘
   â•‘      â”‚           ã€T2ã€‘Generate MWO                                                â•‘
   â•‘      â–¼                                                                             â•‘
   â•‘    mwo_drafted â”€â”€â–¶ mwo_issued â”€â”€â–¶ in_progress â”€â”€â–¶ sample_done                     â•‘
   â•‘       40%              50%            60%            70%                           â•‘
   â•‘                                                        â”‚                           â•‘
   â•‘                                        ã€T5ã€‘Record Actuals                        â•‘
   â•‘                                                        â–¼                           â•‘
   â•‘                          actuals_recorded â”€â”€â–¶ costing_generated â”€â”€â–¶ quoted        â•‘
   â•‘                                80%                   90%             95%           â•‘
   â•‘                                                                       â”‚            â•‘
   â•‘                                              ã€T3ã€‘Submit Quote       â”‚            â•‘
   â•‘                                              ã€T4ã€‘Accept Quote       â”‚            â•‘
   â•‘                                                                       â–¼            â•‘
   â•‘                                                                   accepted         â•‘
   â•‘                                                                     100%           â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### SampleRun ç‹€æ…‹è©³ç´°

| ç‹€æ…‹ | é€²åº¦ | èªªæ˜ |
|------|------|------|
| draft | 0% | è‰ç¨¿ |
| materials_planning | 10% | ç‰©æ–™è¦åŠƒä¸­ |
| po_drafted | 20% | PO å·²èµ·è‰ |
| po_issued | 30% | PO å·²ç™¼å‡º |
| mwo_drafted | 40% | MWO å·²èµ·è‰ |
| mwo_issued | 50% | MWO å·²ç™¼å‡º |
| in_progress | 60% | ç”Ÿç”¢ä¸­ |
| sample_done | 70% | æ¨£è¡£å®Œæˆ |
| actuals_recorded | 80% | å¯¦éš›æ•¸æ“šå·²è¨˜éŒ„ |
| costing_generated | 90% | æˆæœ¬å·²ç”Ÿæˆ |
| quoted | 95% | å·²å ±åƒ¹ |
| accepted | 100% | å·²æ¥å— |

### æ¨£è¡£é¡å‹èˆ‡å ±åƒ¹éœ€æ±‚

```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                     æ¨£è¡£é¡å‹ï¼ˆRun 1-Nï¼‰                                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                                                         â”‚
   â”‚   Run 1: Proto Sample (åŸç‰ˆæ¨£)     1-3ä»¶   âœ… éœ€å ±åƒ¹                    â”‚
   â”‚                                                                         â”‚
   â”‚   Run 2-N: Fit Sample (å°ºå¯¸æ¨£)     2-5ä»¶   âœ… éœ€å ±åƒ¹ â—€â”€ å¯å¤šè¼ªï¼       â”‚
   â”‚            â”œâ”€ Fit 1st (ç¬¬ä¸€æ¬¡å°ºå¯¸æ¨£)                                    â”‚
   â”‚            â”œâ”€ Fit 2nd (ç¬¬äºŒæ¬¡å°ºå¯¸æ¨£)                                    â”‚
   â”‚            â”œâ”€ Fit 3rd (ç¬¬ä¸‰æ¬¡å°ºå¯¸æ¨£)                                    â”‚
   â”‚            â””â”€ ... (ç›´åˆ°å®¢æˆ¶æ‰¹å‡†)                                        â”‚
   â”‚                                                                         â”‚
   â”‚   Run N+1: Size Set Sample (å…¨å¥—)  5-50ä»¶  âœ… éœ€å ±åƒ¹ â—€â”€ æœ€å¾Œå ±åƒ¹æ¨£     â”‚
   â”‚                                                                         â”‚
   â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
   â”‚   ğŸ“ ç”¨é‡ç¢ºèª (confirmed â†’ locked)                                      â”‚
   â”‚   ğŸ“ å¤§è²¨å ±åƒ¹ (CostSheet Bulk)                                          â”‚
   â”‚   ğŸ“ å®¢æˆ¶ç¢ºèª â†’ ProductionOrder                                         â”‚
   â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
   â”‚                                                                         â”‚
   â”‚   Run N+2: PP Sample (ç”¢å‰æ¨£)      10-30ä»¶  âŒ ä¸å ±åƒ¹ï¼ˆåƒ¹æ ¼å·²å®šï¼‰       â”‚
   â”‚   Run N+3: TOP Sample (é ­ç¼¸æ¨£)     50+ä»¶    âŒ ä¸å ±åƒ¹ï¼ˆå¾å¤§è²¨æ‰£ï¼‰       â”‚
   â”‚                                                                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨£è¡£é¡å‹å°ç…§è¡¨

| Run | é¡å‹ | æ•¸é‡ | éœ€å ±åƒ¹ï¼Ÿ | èªªæ˜ |
|-----|------|------|----------|------|
| 1 | Proto Sample (åŸç‰ˆæ¨£) | 1-3 ä»¶ | âœ… æ˜¯ | ç¢ºèªç‰ˆå‹è¨­è¨ˆ |
| 2-N | Fit Sample (å°ºå¯¸æ¨£) | 2-5 ä»¶/è¼ª | âœ… æ˜¯ | ç¢ºèªåˆèº«åº¦ï¼Œ**å¯å¤šè¼ª** |
| N+1 | Size Set Sample (å…¨å¥—å°ºå¯¸æ¨£) | 5-50 ä»¶ | âœ… æ˜¯ | æœ€å¾Œå ±åƒ¹æ¨£ |
| | **â•â•â• å¤§è²¨å ±åƒ¹ + ä¸‹å–® â•â•â•** | | | |
| N+2 | PP Sample (ç”¢å‰æ¨£) | 10-30 ä»¶ | âŒ å¦ | åƒ¹æ ¼å·²å®š |
| N+3 | TOP Sample (é ­ç¼¸æ¨£) | 50+ ä»¶ | âŒ å¦ | å¾å¤§è²¨æ‰£é™¤ |

### Fit Sample å¤šè¼ªèªªæ˜

å¯¦éš›æ¥­å‹™ä¸­ï¼ŒFit Sample é€šå¸¸éœ€è¦å¤šè¼ªèª¿æ•´ï¼š

```
Fit 1st â”€â”€â–¶ å®¢æˆ¶è©•è«– â”€â”€â–¶ èª¿æ•´ â”€â”€â–¶ Fit 2nd â”€â”€â–¶ å®¢æˆ¶è©•è«– â”€â”€â–¶ èª¿æ•´ â”€â”€â–¶ Fit 3rd â”€â”€â–¶ æ‰¹å‡†
   â”‚                                â”‚                                â”‚
   â””â”€â”€ æ¯è¼ªéƒ½æ˜¯ç¨ç«‹çš„ SampleRun â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€ æ¯è¼ªéƒ½éœ€è¦å ±åƒ¹å’Œæˆæœ¬è¿½è¹¤
```

**å¸¸è¦‹æƒ…æ³ï¼š**
- ç°¡å–®æ¬¾å¼ï¼š1-2 è¼ª Fit Sample
- è¤‡é›œæ¬¾å¼ï¼š3-5 è¼ª Fit Sample
- é«˜ç«¯å“ç‰Œï¼šå¯èƒ½éœ€è¦æ›´å¤šè¼ªæ¬¡

### Phase 2 è§¸ç™¼é»

| è§¸ç™¼é» | æŒ‰éˆ•æ–‡å­— | API | é é¢ |
|--------|----------|-----|------|
| **T1** | Create Sample Request | `POST /api/v2/sample-requests/` | Revision è©³æƒ…é  |
| **T1+** | Confirm Sample | `POST /api/v2/sample-requests/{id}/confirm/` | Request è©³æƒ…é  |
| **T1++** | Create Next Run | `POST /api/v2/sample-requests/{id}/create-next-run/` | Request è©³æƒ…é  |
| **T2** | Generate MWO | `POST /api/v2/sample-runs/{id}/generate-mwo/` | Kanban |
| **T3** | Submit Quote | `POST /api/v2/cost-sheet-versions/{id}/submit/` | CostingDrawer |
| **T4** | Accept Quote | `POST /api/v2/cost-sheet-versions/{id}/accept/` | CostingDrawer |
| **T5** | Record Actuals | `POST /api/v2/sample-runs/{id}/record-actuals/` | Kanban |

### å¤šè¼ª Fit Sample æµç¨‹ (P25)

```
Fit Sample å¤šè¼ªèª¿æ•´æµç¨‹ï¼š

  Run #1 (Fit)
    â”‚
    â”œâ”€â”€ è£½ä½œå®Œæˆ
    â”‚
    â”œâ”€â”€ å®¢æˆ¶è©•è«–/åé¥‹
    â”‚
    â”‚ ã€T1++ã€‘Create Next Run  â—€â”€â”€â”€â”€â”€â”€ å‰µå»ºä¸‹ä¸€è¼ª
    â–¼
  Run #2 (Fit)
    â”‚
    â”œâ”€â”€ æ ¹æ“šåé¥‹èª¿æ•´
    â”‚
    â”œâ”€â”€ å†æ¬¡è£½ä½œ
    â”‚
    â”‚ ã€T1++ã€‘Create Next Run  â—€â”€â”€â”€â”€â”€â”€ å¯ç¹¼çºŒå‰µå»º
    â–¼
  Run #3 (Fit)
    â”‚
    â””â”€â”€ ... ç›´åˆ°å®¢æˆ¶æ‰¹å‡†
         â”‚
         â–¼
    Size Set Sample â†’ å¤§è²¨å ±åƒ¹
```

**T1++ Create Next Run è‡ªå‹•ç”Ÿæˆå…§å®¹ï¼š**
```
POST /api/v2/sample-requests/{id}/create-next-run/
    â†“
1. è‡ªå‹•è¨ˆç®— run_no = max(run_no) + 1
2. ç¹¼æ‰¿ä¸Šä¸€è¼ª run_type (å¯è¦†è“‹)
3. ç¹¼æ‰¿ä¸Šä¸€è¼ª quantity (å¯è¦†è“‹)
4. å¿«ç…§æœ€æ–° BOM â†’ RunBOMLine
5. å¿«ç…§æœ€æ–° Operations â†’ RunOperation
6. å¿«ç…§æœ€æ–° TechPack â†’ RunTechPackPage/Block
7. ç”Ÿæˆæ–° MWO (draft)
8. ç”Ÿæˆæ–° CostSheetVersion (sample)
```

### T1+ Confirm Sample è‡ªå‹•ç”Ÿæˆå…§å®¹

ç¢ºèªæ¨£è¡£æ™‚ï¼Œå¾Œç«¯è‡ªå‹•ç”Ÿæˆä»¥ä¸‹å…§å®¹ï¼ˆåŸå­äº¤æ˜“ï¼‰ï¼š

```
POST /api/v2/sample-requests/{id}/confirm/
    â†“
1. SampleRun #1 (status: DRAFT)
2. RunBOMLine (å¿«ç…§å·²é©—è­‰çš„ BOMItem)
3. RunOperation (å¿«ç…§å·²é©—è­‰çš„ ConstructionStep)
4. SampleMWO (draft, ç·¨è™Ÿ: MWO-YYMM-XXXXXX)
5. SampleCostEstimate (draft)
6. UsageScenario (purpose='sample_quote') + CostSheetVersion (costing_type='sample')
```

---

## å››ã€Phase 3ï¼šå ±åƒ¹éšæ®µ

### æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Phase 3: å ±åƒ¹éšæ®µ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Size Set Run (accepted)
         â”‚
         â”‚ ã€T6ã€‘Create Bulk Quote
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   CostSheetVersion (bulk)                                       â”‚
   â”‚   â”œâ”€ cloned_from = æœ€å¾Œä¸€ç‰ˆ Sample CostSheet â—€â”€ é—œéµé€£çµ       â”‚
   â”‚   â”œâ”€ UsageScenario (purpose='bulk_quote')                       â”‚
   â”‚   â”‚      â””â”€ UsageLine[] (consumption = locked_value)            â”‚
   â”‚   â”œâ”€ material_cost (å¾é–å®šç”¨é‡è¨ˆç®—)                             â”‚
   â”‚   â”œâ”€ labor_cost (å¯èƒ½å› é‡å¤§èª¿æ•´)                                â”‚
   â”‚   â””â”€ unit_price (å¤§è²¨åƒ¹)                                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ ã€T7ã€‘Submit Bulk Quote
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ status: draft   â”‚â”€â”€â–¶ submitted â”€â”€â–¶ accepted/rejected
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ accepted
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¯å‰µå»º Production Order â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨é‡ä¸‰éšæ®µæ¼”é€²

```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                          BOM ç”¨é‡å››éšæ®µæ•¸æ“šæµ                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      consumption          pre_estimate_value       confirmed_value        locked_value
     (Tech Pack åŸå§‹)    â”€â”€â”€â”€â–¶ (å·¥å» ä¼°ç®—)     â”€â”€â”€â”€â–¶ (Marker ç¢ºèª)   â”€â”€â”€â”€â–¶  (å¤§è²¨é–å®š)
           â”‚                       â”‚                     â”‚                     â”‚
           â”‚                       â”‚                     â”‚                     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                              current_consumption (è‡ªå‹•é¸æ“‡æœ€æ–°å€¼)
                              â”œâ”€ å„ªå…ˆç´šï¼šlocked > confirmed > pre_estimate > consumption
                              â””â”€ å ±åƒ¹æ™‚è®€å–æ­¤å€¼
```

### ç”¨é‡æ•¸æ“šæµè©³ç´°

```
BOMItem.consumption (åŸå§‹ç”¨é‡ - Tech Pack æ¨™è¨»)
     â”‚
     â”œâ”€â”€â†’ pre_estimate_value (é ä¼°ç”¨é‡)
     â”‚    â”œâ”€ ä¾†æºï¼šå·¥å» ç¶“é©—ä¼°ç®—
     â”‚    â””â”€ ç”¨é€”ï¼šRFQ è©¢åƒ¹å–® âœ…
     â”‚
     â”œâ”€â”€â†’ confirmed_value (ç¢ºèªç”¨é‡)
     â”‚    â”œâ”€ ä¾†æºï¼šMarker Report / æ¨£è¡£å¯¦éš›
     â”‚    â””â”€ ç”¨é€”ï¼šRFQ âœ… / å¤§è²¨å ±åƒ¹ âœ… / ç”Ÿç”¢æ¡è³¼ âœ…
     â”‚
     â””â”€â”€â†’ locked_value (é–å®šç”¨é‡)
          â”œâ”€ ä¾†æºï¼šå¤§è²¨ç¢ºèªé–å®šï¼ˆä¸å¯å†æ”¹ï¼‰
          â””â”€ ç”¨é€”ï¼šæœ€çµ‚ç”Ÿç”¢æ¡è³¼ âœ… / MRP è¨ˆç®— âœ… / æˆæœ¬çµç®— âœ…
```

### å ±åƒ¹æ¨¡å‹æ¶æ§‹

```
UsageScenario (ç”¨é‡å ´æ™¯)
â”œâ”€â”€ purpose: 'sample_quote' | 'bulk_quote'
â”œâ”€â”€ version_no
â””â”€â”€ UsageLine[] (ç‰©æ–™ç”¨é‡)
         â”‚
         â†“
CostSheetVersion (å ±åƒ¹ç‰ˆæœ¬)
â”œâ”€â”€ costing_type: 'sample' | 'bulk'
â”œâ”€â”€ status: draft â†’ submitted â†’ accepted/rejected
â”œâ”€â”€ cloned_from FK (ç‰ˆæœ¬è¿½æº¯) â­ æ ¸å¿ƒé€£çµ
â””â”€â”€ CostLineV2[] (æˆæœ¬æ˜ç´°)
```

### Phase 3 è§¸ç™¼é»

| è§¸ç™¼é» | æŒ‰éˆ•æ–‡å­— | API | é é¢ |
|--------|----------|-----|------|
| **T6** | Create Bulk Quote | `POST /api/v2/cost-sheet-versions/{id}/create-bulk-quote/` | CostingDrawer |
| **T7** | Submit Bulk Quote | `POST /api/v2/cost-sheet-versions/{id}/submit/` | CostingDrawer |

---

## äº”ã€Phase 4ï¼šå¤§è²¨éšæ®µ

### æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Phase 4: å¤§è²¨éšæ®µ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Bulk CostSheet (accepted)
         â”‚
         â”‚ ã€T8ã€‘Create Production Order
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   ProductionOrder                                               â”‚
   â”‚   â”œâ”€ bulk_costing FK â†’ CostSheetVersion                         â”‚
   â”‚   â”œâ”€ approved_sample_run FK â† åå‘é€£çµ                          â”‚
   â”‚   â”œâ”€ å°ºç¢¼åˆ†è§£ (S=1000, M=3000, L=4000, XL=2000)                 â”‚
   â”‚   â””â”€ ç¸½æ•¸é‡ï¼š10,000 ä»¶                                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ ã€T9ã€‘Confirm Order
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   status: draft â†’ confirmed                                     â”‚
   â”‚                                                                 â”‚
   â”‚   è§¸ç™¼ MRP è¨ˆç®—ï¼š                                               â”‚
   â”‚   MaterialRequirement[]                                         â”‚
   â”‚   â”œâ”€ æ¯å€‹ BOM é …ç›®è¨ˆç®—ï¼š                                        â”‚
   â”‚   â”‚   æ¡è³¼æ•¸é‡ = è¨‚å–®æ•¸é‡ Ã— locked_value Ã— (1 + wastage%)       â”‚
   â”‚   â””â”€ è¼¸å‡ºï¼šç‰©æ–™éœ€æ±‚æ¸…å–®                                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ ã€T10ã€‘Generate PO
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   PurchaseOrderï¼ˆæŒ‰ä¾›æ‡‰å•†åˆ†çµ„ï¼‰                                  â”‚
   â”‚   â”œâ”€ æ¯ç­†ç‰©æ–™ç¨ç«‹ PO                                            â”‚
   â”‚   â”œâ”€ ä¸‹è¼‰ PDF                                                   â”‚
   â”‚   â””â”€ ç™¼é€çµ¦ä¾›æ‡‰å•†ï¼ˆEmailï¼‰                                      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   PO ç‹€æ…‹æ©Ÿ                                                     â”‚
   â”‚                                                                 â”‚
   â”‚   draft â”€â”€â–¶ sent â”€â”€â–¶ confirmed â”€â”€â–¶ partial_received/received   â”‚
   â”‚                                                                 â”‚
   â”‚   any â†’ cancelled                                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MRP è¨ˆç®—å…¬å¼

```
gross_requirement = order_quantity Ã— consumption_per_piece
wastage_quantity = gross_requirement Ã— wastage_pct%
total_requirement = gross_requirement + wastage_quantity
order_quantity_needed = max(0, total_requirement - current_stock)
```

### æ¡è³¼æ•¸é‡è¨ˆç®—ç¯„ä¾‹

```
æ¡è³¼æ•¸é‡ = è¨‚å–®æ•¸é‡ Ã— locked_value Ã— (1 + wastage_pct%)

ç¯„ä¾‹ï¼š
= 10,000 ä»¶ Ã— 0.82 yd Ã— 1.05 = 8,610 yards
```

### Phase 4 è§¸ç™¼é»

| è§¸ç™¼é» | æŒ‰éˆ•æ–‡å­— | API | é é¢ |
|--------|----------|-----|------|
| **T8** | Create Production Order | `POST /api/v2/production-orders/` | PO åˆ—è¡¨é  |
| **T9** | Confirm Order | `POST /api/v2/production-orders/{id}/confirm/` | PO è©³æƒ…é  |
| **T10** | Generate PO | `POST /api/v2/production-orders/{id}/generate-po/` | PO è©³æƒ…é  |
| - | Send PO | `POST /api/v2/purchase-orders/{id}/send/` | PO è©³æƒ…é  |

### PO ç‹€æ…‹æ©Ÿ

```
draft â†’ sent â†’ confirmed â†’ partial_received/received
any â†’ cancelled
```

### ProductionOrder ç‹€æ…‹æ©Ÿ

```
draft â†’ confirmed â†’ materials_ordered â†’ in_production â†’ completed
```

---

## å…­ã€è§¸ç™¼é»ç¸½è¡¨ (T1-T10)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            è§¸ç™¼é»ç¸½è¦½ (T1-T10)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç·¨è™Ÿ â”‚ æ“ä½œ                 â”‚ API                                â”‚ é¡¯ç¤ºæ¢ä»¶           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ T1   â”‚ Create Sample Requestâ”‚ POST /sample-requests/             â”‚ Revision approved  â”‚
â”‚ T1+  â”‚ Confirm Sample       â”‚ POST /sample-requests/{id}/confirm/â”‚ Request draft      â”‚
â”‚ T2   â”‚ Generate MWO         â”‚ POST /sample-runs/{id}/generate-mwoâ”‚ Run å­˜åœ¨           â”‚
â”‚ T3   â”‚ Submit Quote         â”‚ POST /cost-sheets/{id}/submit/     â”‚ status='draft'     â”‚
â”‚ T4   â”‚ Accept Quote         â”‚ POST /cost-sheets/{id}/accept/     â”‚ status='submitted' â”‚
â”‚ T5   â”‚ Record Actuals       â”‚ POST /sample-runs/{id}/record-actualsâ”‚ sample_done      â”‚
â”‚ T6   â”‚ Create Bulk Quote    â”‚ POST /cost-sheets/{id}/create-bulk/â”‚ Size Set accepted  â”‚
â”‚ T7   â”‚ Submit Bulk Quote    â”‚ POST /cost-sheets/{id}/submit/     â”‚ bulk draft         â”‚
â”‚ T8   â”‚ Create Prod Order    â”‚ POST /production-orders/           â”‚ Bulk accepted      â”‚
â”‚ T9   â”‚ Confirm Order        â”‚ POST /production-orders/{id}/confirmâ”‚ PO draft          â”‚
â”‚ T10  â”‚ Generate PO          â”‚ POST /production-orders/{id}/generate-poâ”‚ PO confirmed  â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§¸ç™¼é»è©³ç´°èªªæ˜

| è§¸ç™¼é» | æŒ‰éˆ•æ–‡å­— | ä½ç½® | é¡¯ç¤ºæ¢ä»¶ | API |
|--------|----------|------|----------|-----|
| T1 | Create Sample Request | Revision è©³æƒ…é  | Revision approved | `POST /sample-requests/` |
| T1+ | Confirm Sample | Request è©³æƒ…é  | Request draft | `POST /sample-requests/{id}/confirm/` |
| T2 | Edit Costing | Kanban Run å¡ç‰‡ | Run å­˜åœ¨ | - |
| T3 | Submit Quote | Costing ç·¨è¼¯é  | status='draft' | `POST /cost-sheets/{id}/submit/` |
| T4 | Accept Quote | Kanban ç‹€æ…‹æŒ‰éˆ• | status='quoted' | `POST /sample-runs/{id}/accept/` |
| T5 | Sample Done | Kanban ç‹€æ…‹æŒ‰éˆ• | Size Set Run | `POST /sample-runs/{id}/complete/` |
| **T6** | **Create Bulk Quote** | Request è©³æƒ…é  | Size Set completed | `POST /cost-sheets/{id}/create-bulk-quote/` |
| T7 | Submit Bulk Quote | Bulk Costing é  | status='draft' | `POST /cost-sheets/{id}/submit/` |
| **T8** | **Create Production Order** | Bulk CostSheet é  | Bulk accepted | `POST /production-orders/` |
| T9 | Confirm Order | PO è©³æƒ…é  | status='draft' | `POST /production-orders/{id}/confirm/` |
| T10 | Generate PO | PO è©³æƒ…é  | status='confirmed' | `POST /production-orders/{id}/generate-po/` |

### æµç¨‹é€£çµå®Œæ•´æ€§

```
SampleRun (Size Set, accepted)
     â”‚
     â”œâ”€â”€â†’ costing_version FK â†’ CostSheetVersion (sample)
     â”‚                              â”‚
     â”‚                              â†“ POST /create-bulk-quote/
     â”‚                         CostSheetVersion (bulk, accepted)
     â”‚                              â”‚
     â”‚                              â†“ POST /create-production-order/
     â”‚                         ProductionOrder
     â”‚                              â”œâ”€â”€â†’ bulk_costing FK
     â”‚                              â”œâ”€â”€â†’ approved_sample_run FK â† åå‘é€£çµï¼
     â”‚                              â”‚
     â”‚                              â†“ POST /generate-po/
     â”‚                         PurchaseOrder + POLine
     â”‚                              â”‚
     â”‚                              â†“ Signal: post_save
     â”‚                         MaterialRequirement.status = 'ordered'/'received'
```

---

## ä¸ƒã€æ•¸æ“šæ¨¡å‹é—œè¯åœ–

### æ ¸å¿ƒé—œè¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ ¸å¿ƒæ•¸æ“šé—œè¯                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Style
      â”‚
      â””â”€â”€â–¶ Revision â”€â”€â”¬â”€â”€â–¶ BOMItem (Verified) â”€â”€â”¬â”€â”€â–¶ UsageLine â”€â”€â–¶ CostLineV2
                      â”‚                         â”‚
                      â”œâ”€â”€â–¶ Measurement          â”‚
                      â”‚                         â”‚
                      â”œâ”€â”€â–¶ SampleRequest â”€â”€â”¬â”€â”€â–¶ SampleRun â”€â”€â”¬â”€â”€â–¶ SampleMWO
                      â”‚                    â”‚                â”‚
                      â”‚                    â”‚                â”œâ”€â”€â–¶ CostSheetVersion (sample)
                      â”‚                    â”‚                â”‚         â”‚
                      â”‚                    â”‚                â”‚         â”‚ cloned_from
                      â”‚                    â”‚                â”‚         â–¼
                      â”‚                    â”‚                â”‚    CostSheetVersion (bulk)
                      â”‚                    â”‚                â”‚
                      â”‚                    â”‚                â””â”€â”€â–¶ PurchaseOrder (T2)
                      â”‚                    â”‚
                      â””â”€â”€â–¶ ProductionOrder â”€â”€â”¬â”€â”€â–¶ MaterialRequirement
                                             â”‚
                                             â””â”€â”€â–¶ PurchaseOrder (å¤§è²¨)
```

### ç°¡åŒ–é—œè¯åœ–

```
Style â†’ Revision â†’ BOMItem (Verified)
                 â†’ Measurement
                 â†’ SampleRequest â†’ SampleRun â†’ MWO
                                            â†’ CostSheetVersion
                                            â†’ PurchaseOrder
                 â†’ ProductionOrder â†’ MaterialRequirement â†’ PurchaseOrder
```

### BOM â†’ Cost æ•¸æ“šé€£å‹•

```
BOMItem (ç‰©æ–™è¡¨)
    â”œâ”€ consumption (å–®ä½ç”¨é‡)
    â”œâ”€ unit_price (å–®åƒ¹)
    â”œâ”€ pre_estimate_value / confirmed_value / locked_value (ä¸‰éšæ®µ)
    â†“ (è¤‡è£½)
UsageLine (ç”¨é‡æ˜ç´°)
    â”œâ”€ bom_item (FK)
    â”œâ”€ consumption (è¤‡è£½è‡ª BOMItem.current_consumption)
    â”œâ”€ adjusted_consumption (è¨ˆç®—: consumption Ã— (1 + wastage%))
    â†“ (å¿«ç…§)
CostLineV2 (æˆæœ¬æ˜ç´°)
    â”œâ”€ source_bom_item_id (UUIDï¼Œé FK)
    â”œâ”€ consumption_snapshot (å‡çµå€¼)
    â”œâ”€ consumption_adjusted (å¯ç·¨è¼¯)
    â”œâ”€ unit_price_snapshot (å‡çµå€¼)
    â”œâ”€ unit_price_adjusted (å¯ç·¨è¼¯)
    â”œâ”€ line_cost = consumption_adjusted Ã— unit_price_adjusted
    â†“
CostSheetVersion (å ±åƒ¹ç‰ˆæœ¬)
    â”œâ”€ total_material_cost
    â”œâ”€ total_cost
    â””â”€ unit_price
```

---

## é™„éŒ„ï¼šAPI ç«¯é»ç´¢å¼•

### Sample ç›¸é—œ

```
POST   /api/v2/sample-requests/                    # å‰µå»ºè«‹æ±‚
POST   /api/v2/sample-requests/{id}/confirm/       # ç¢ºèªæ¨£è¡£
GET    /api/v2/kanban/runs/                        # Kanban åˆ—è¡¨
POST   /api/v2/sample-runs/{id}/{action}/          # ç‹€æ…‹è½‰æ›
GET    /api/v2/sample-runs/{id}/export-mwo-complete-pdf/  # MWO åŒ¯å‡º
```

### BOM/Spec ç›¸é—œ

```
GET    /api/v2/style-revisions/{id}/bom/           # BOM åˆ—è¡¨
POST   /api/v2/style-revisions/{id}/bom/           # æ–°å¢ BOM
PATCH  /api/v2/style-revisions/{id}/bom/{pk}/      # ç·¨è¼¯ BOM
DELETE /api/v2/style-revisions/{id}/bom/{pk}/      # åˆªé™¤ BOM
POST   /api/v2/style-revisions/{id}/bom/translate-batch/  # æ‰¹é‡ç¿»è­¯

GET    /api/v2/style-revisions/{id}/measurements/  # Spec åˆ—è¡¨
POST   /api/v2/style-revisions/{id}/measurements/  # æ–°å¢ Spec
PATCH  /api/v2/style-revisions/{id}/measurements/{pk}/  # ç·¨è¼¯ Spec
DELETE /api/v2/style-revisions/{id}/measurements/{pk}/  # åˆªé™¤ Spec
```

### Costing ç›¸é—œ

```
POST   /api/v2/cost-sheet-versions/{id}/submit/           # æäº¤å ±åƒ¹
POST   /api/v2/cost-sheet-versions/{id}/accept/           # ç¢ºèªå ±åƒ¹
POST   /api/v2/cost-sheet-versions/{id}/create-bulk-quote/ # å‰µå»ºå¤§è²¨å ±åƒ¹
POST   /api/v2/cost-sheet-versions/{id}/refresh-snapshot/ # åˆ·æ–°å¿«ç…§
```

### Production ç›¸é—œ

```
POST   /api/v2/production-orders/                  # å‰µå»ºè¨‚å–®
POST   /api/v2/production-orders/{id}/confirm/     # ç¢ºèªè¨‚å–®
POST   /api/v2/production-orders/{id}/calculate-mrp/  # MRP è¨ˆç®—
POST   /api/v2/production-orders/{id}/generate-po/    # ç”Ÿæˆ PO
```

### Purchase Order ç›¸é—œ

```
GET    /api/v2/purchase-orders/                    # PO åˆ—è¡¨
GET    /api/v2/purchase-orders/{id}/               # PO è©³æƒ…
POST   /api/v2/purchase-orders/{id}/send/          # ç™¼é€ PO Email
GET    /api/v2/purchase-orders/{id}/download-pdf/  # ä¸‹è¼‰ PO PDF
```

---

## è¨­è¨ˆåŸå‰‡

1. **å¿«ç…§åŸå‰‡**ï¼šRun çš„ BOM/Operation æ˜¯è¤‡è£½ï¼Œä¸æ˜¯ FK
2. **ä¸å¯å›å¯«**ï¼šPhase 3 è³‡æ–™ä¸å¾—ä¿®æ”¹ Phase 2 çš„ verified è³‡æ–™
3. **æ¡è³¼æ‹†å–®**ï¼šT2 PO æŒ‰ä¾›æ‡‰å•†æ‹†åˆ†ï¼Œåˆ† Draft/Issued
4. **æ–‡ä»¶ç·¨è™Ÿ**ï¼šMWO-YYMM-XXXXXX æ ¼å¼ï¼Œç”¨ sequence é¿å…æ’è™Ÿ
5. **SampleRun æ˜¯å”¯ä¸€çš„ã€ŒåŸ·è¡ŒçœŸç›¸ä¾†æºã€**ï¼šMWO / Estimate / T2 PO éƒ½æ˜¯ Run çš„è¼¸å‡ºæ–‡ä»¶

---

**å»ºç«‹è€…ï¼š** Claude Code
**æ—¥æœŸï¼š** 2026-01-18
